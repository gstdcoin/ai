# PULL-MODEL –ê–†–•–ò–¢–ï–ö–¢–£–†–ê - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

## üéØ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

**PULL-MODEL**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∞–º–∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç –∏ –æ–ø–ª–∞—á–∏–≤–∞—é—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ TonConnect.
–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Ç–æ–ª—å–∫–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç intent'—ã, –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –∫–ª—é—á–∞–º.

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏
2. **–î–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç —Å–≤–æ–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
3. **–ì–∞–∑ –æ–ø–ª–∞—á–∏–≤–∞—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏**: –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –Ω–µ —Ç—Ä–∞—Ç–∏—Ç TON –Ω–∞ gas fees
4. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å**: –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–∏–¥–Ω—ã –≤ –±–ª–æ–∫—á–µ–π–Ω–µ

## üìã –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –î–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π (Workers)

1. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: Worker –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
3. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è intent**: Worker –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç payout intent:
   ```bash
   POST /api/v1/payments/payout-intent
   {
     "task_id": "...",
     "executor_address": "EQ..."
   }
   ```
4. **–ü–æ–ª—É—á–µ–Ω–∏–µ intent**: –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
   ```json
   {
     "to_address": "ESCROW_CONTRACT_ADDRESS",
     "amount_nano": 10000000,  // 0.01 TON –¥–ª—è gas
     "payload_comment": "WITHDRAW|task:...|exec:...|fee:...|reward:...",
     "executor_reward_ton": 0.95,
     "platform_fee_ton": 0.05,
     "task_id": "...",
     "executor_address": "EQ..."
   }
   ```
5. **–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**: Worker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç TonConnect –¥–ª—è –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è
6. **–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ escrow**: Worker –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ escrow –∫–æ–Ω—Ç—Ä–∞–∫—Ç
7. **–ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥—ã**: Escrow –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 95% –Ω–∞–≥—Ä–∞–¥—ã worker'—É
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 5% –∫–æ–º–∏—Å—Å–∏–∏ –≤ treasury
   - Worker –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç gas fees –∏–∑ —Å–≤–æ–µ–≥–æ –∫–æ—à–µ–ª—å–∫–∞

### –î–ª—è –∑–∞–∫–∞–∑—á–∏–∫–æ–≤ (Requesters)

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏**: Requester —Å–æ–∑–¥–∞–µ—Ç –∑–∞–¥–∞—á—É —á–µ—Ä–µ–∑ API
2. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤**: Requester –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç TON –≤ escrow –∫–æ–Ω—Ç—Ä–∞–∫—Ç
3. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**: Workers –≤—ã–ø–æ–ª–Ω—è—é—Ç –∑–∞–¥–∞—á—É
4. **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
5. **–í—ã–ø–ª–∞—Ç—ã**: Workers —Å–∞–º–∏ –∑–∞–±–∏—Ä–∞—é—Ç –Ω–∞–≥—Ä–∞–¥—ã (—Å–º. –≤—ã—à–µ)

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (PULL-MODEL)

```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
TON_CONTRACT_ADDRESS=<escrow_contract_address>
GSTD_JETTON_ADDRESS=<gstd_jetton_address>
TON_API_URL=https://tonapi.io
TON_API_KEY=<your_api_key>

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (—Ç–æ–ª—å–∫–æ –¥–ª—è admin –æ–ø–µ—Ä–∞—Ü–∏–π, –µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
PLATFORM_WALLET_ADDRESS=<–≤–∞—à_–∞–¥—Ä–µ—Å>  # –¢–æ–ª—å–∫–æ –∞–¥—Ä–µ—Å, –±–µ–∑ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
```

### –ü–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π –∫–æ—à–µ–ª–µ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏–º–µ—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π –∫–æ—à–µ–ª–µ–∫ –¥–ª—è admin –æ–ø–µ—Ä–∞—Ü–∏–π:
- –°–æ–∑–¥–∞–π—Ç–µ –∫–æ—à–µ–ª–µ–∫ —Å–∞–º–∏
- –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–ª—å–∫–æ –∞–¥—Ä–µ—Å –≤ `.env`
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ TON –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ - –≤—ã –ø–æ–¥–ø–∏—à–µ—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤—Ä—É—á–Ω—É—é

**–ù–ï –ù–£–ñ–ù–û**:
- ‚ùå –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- ‚ùå Seed phrase –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- ‚ùå –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–≥–æ –∫–æ—à–µ–ª—å–∫–∞

## üìù API Endpoints

### –ü–æ–ª—É—á–∏—Ç—å payout intent

```bash
POST /api/v1/payments/payout-intent
{
  "task_id": "task_123",
  "executor_address": "EQ..."
}
```

**Response**:
```json
{
  "to_address": "ESCROW_CONTRACT",
  "amount_nano": 10000000,
  "payload_comment": "WITHDRAW|task:...|exec:...|fee:...|reward:...",
  "executor_reward_ton": 0.95,
  "platform_fee_ton": 0.05,
  "task_id": "task_123",
  "executor_address": "EQ..."
}
```

### Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```typescript
// 1. –ü–æ–ª—É—á–∏—Ç—å intent
const intent = await fetch('/api/v1/payments/payout-intent', {
  method: 'POST',
  body: JSON.stringify({ task_id, executor_address })
}).then(r => r.json())

// 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TonConnect –¥–ª—è –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è
const transaction = {
  to: intent.to_address,
  value: intent.amount_nano.toString(),
  body: buildWithdrawCell(intent) // –°–æ–∑–¥–∞—Ç—å Cell —Å Withdraw message
}

await tonConnectUI.sendTransaction(transaction)
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ß—Ç–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ù–ï –¥–µ–ª–∞–µ—Ç:
- ‚ùå –ù–µ —Ö—Ä–∞–Ω–∏—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚ùå –ù–µ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚ùå –ù–µ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç gas fees
- ‚ùå –ù–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—Ä–µ–¥—Å—Ç–≤–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ß—Ç–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–µ–ª–∞–µ—Ç:
- ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç payout intent'—ã
- ‚úÖ –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–¥–∞—á
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á
- ‚úÖ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è intent'–æ–≤

## üí∞ –ö–æ–º–∏—Å—Å–∏–∏

### Gas Fees
- **–û–ø–ª–∞—á–∏–≤–∞–µ—Ç**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (worker –∏–ª–∏ requester)
- **–†–∞–∑–º–µ—Ä**: ~0.01-0.1 TON –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### Platform Fee
- **–†–∞–∑–º–µ—Ä**: 5% –æ—Ç –Ω–∞–≥—Ä–∞–¥—ã
- **–°–±–æ—Ä**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ escrow –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º –ø—Ä–∏ –≤—ã–ø–ª–∞—Ç–µ
- **–ü–æ–ª—É—á–∞—Ç–µ–ª—å**: Treasury wallet (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ)

## üéØ Escrow –ö–æ–Ω—Ç—Ä–∞–∫—Ç

Escrow –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–µ–ø–æ–∑–∏—Ç—ã –æ—Ç requesters
2. –í—ã–ø–ª–∞—á–∏–≤–∞–µ—Ç –Ω–∞–≥—Ä–∞–¥—ã workers –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ Withdraw —Å–æ–æ–±—â–µ–Ω–∏—è
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç platform fee –≤ treasury
4. –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç replay –∞—Ç–∞–∫ (nonce)
5. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å–∏

## üìä –°—Ç–∞—Ç—É—Å

‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û**:
- PULL-MODEL –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- BuildPayoutIntent endpoint
- Escrow –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è pull-model
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

‚úÖ **–ù–ï –ù–£–ñ–ù–û**:
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã
- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–≥–æ –∫–æ—à–µ–ª—å–∫–∞ –¥–ª—è –≤—ã–ø–ª–∞—Ç

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ escrow –∫–æ–Ω—Ç—Ä–∞–∫—Ç** –Ω–∞ TON blockchain
2. **–î–æ–±–∞–≤—å—Ç–µ –∞–¥—Ä–µ—Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞** –≤ `.env`: `TON_CONTRACT_ADDRESS=...`
3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É**: `docker-compose up -d`
4. **Workers –∑–∞–±–∏—Ä–∞—é—Ç –Ω–∞–≥—Ä–∞–¥—ã** —á–µ—Ä–µ–∑ TonConnect, –æ–ø–ª–∞—á–∏–≤–∞—è gas —Å–∞–º–∏

---

**–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ –±–µ–∑ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞!** üéâ

