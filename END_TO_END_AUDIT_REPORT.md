# üîç End-to-End Audit Report - GSTD Platform Business Logic

**–î–∞—Ç–∞:** 11 —è–Ω–≤–∞—Ä—è 2026  
**–¢–∏–ø:** –°–∫–≤–æ–∑–Ω–æ–π –∞—É–¥–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ (End-to-End)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ó–ê–í–ï–†–®–ï–ù**

---

## üìä Executive Summary

–ü—Ä–æ–≤–µ–¥–µ–Ω –ø–æ–ª–Ω—ã–π —Å–∫–≤–æ–∑–Ω–æ–π –∞—É–¥–∏—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã GSTD. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞:** –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–ª–æ–Ω–∫–∞ `platform_fee_ton` –≤ —Ç–∞–±–ª–∏—Ü–µ `tasks`, —á—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** **75%** (3 –∏–∑ 4 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç)

---

## ‚úÖ 1. Wallet Connection & Auth

### –ü—Ä–æ–≤–µ—Ä–∫–∞: `/api/v1/users/login`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢**

**–ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- Endpoint: `POST /api/v1/users/login` (routes.go:126)
- Handler: `loginUser()` –≤ `routes_user.go`
- Service: `UserService.LoginOrRegister()` –≤ `user_service.go`

**–õ–æ–≥–∏–∫–∞:**
```go
// –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–æ–∑–¥–∞–µ—Ç –µ—Å–ª–∏ –Ω–µ—Ç
func (s *UserService) LoginOrRegister(ctx context.Context, walletAddress string) (*models.User, error)
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏:**
- ‚ùå **–ù–ï –ü–†–û–í–ï–†–Ø–ï–¢–°–Ø** –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
- –õ–æ–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ `wallet_address` (–±–µ–∑ –ø–æ–¥–ø–∏—Å–∏)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏:
  - –û—Ç–ø—Ä–∞–≤–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–¥–∞—á–∏ (`validation_service.go:310`)
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Ed25519 –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–í—ã–≤–æ–¥:**
- ‚úÖ Endpoint –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
- ‚ö†Ô∏è –õ—é–±–æ–π –º–æ–∂–µ—Ç –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è, –∑–Ω–∞—è –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ TonConnect –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

---

## ‚ö†Ô∏è 2. Task Creation

### –ü—Ä–æ–≤–µ—Ä–∫–∞: `/api/v1/tasks/create`

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û –†–ê–ë–û–¢–ê–ï–¢**

**–ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- Endpoint: `POST /api/v1/tasks/create` (routes.go:133)
- Handler: `createTaskWithPayment()` 
- Service: `TaskPaymentService.CreateTask()` –≤ `task_payment_service.go:47`

**–õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏:**
```go
// task_payment_service.go:85-94
INSERT INTO tasks (
    task_id, creator_wallet, requester_address, task_type, operation, model,
    input_source, input_hash,
    status, budget_gstd, reward_gstd, payment_memo, payload,
    created_at, escrow_status
) VALUES (...)
```

**–ü—Ä–æ–±–ª–µ–º–∞ —Å `executor_reward_ton`:**
- ‚ùå **–ù–ï –ó–ê–ü–û–õ–ù–Ø–ï–¢–°–Ø** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏
- –ö–æ–ª–æ–Ω–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ: `executor_reward_ton numeric(20,9)`)
- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ü–û–°–õ–ï –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —á–µ—Ä–µ–∑:
  - `reward_engine.go:115` (UPDATE tasks SET executor_reward_ton = $3)
  - `result_service.go:170` (UPDATE tasks SET executor_reward_ton = $2)

**–†–∞—Å—á–µ—Ç `executor_reward_ton`:**
```go
// reward_engine.go:93-94
workerReward := budget * 0.95  // 95% –≤–æ—Ä–∫–µ—Ä—É
platformFee := budget * 0.05    // 5% –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
executor_reward_ton = workerReward
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î:**
```sql
SELECT count(*) FROM tasks;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 0 (–Ω–µ—Ç –∑–∞–¥–∞—á –≤ –ë–î)
```

**–í—ã–≤–æ–¥:**
- ‚úÖ Endpoint —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚ö†Ô∏è `executor_reward_ton` –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è Pull-–º–æ–¥–µ–ª–∏)
- ‚ùå **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–ª–æ–Ω–∫–∞ `platform_fee_ton` –≤ —Ç–∞–±–ª–∏—Ü–µ `tasks`

**–û—à–∏–±–∫–∞ –≤ –∫–æ–¥–µ:**
```go
// result_service.go:169-170
SET platform_fee_ton = $1,  // ‚ùå –ö–æ–ª–æ–Ω–∫–∞ –ù–ï –°–£–©–ï–°–¢–í–£–ï–¢ –≤ –ë–î
    executor_reward_ton = $2
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏ `platform_fee_ton`.

---

## ‚úÖ 3. Payment Tracking

### –ü—Ä–æ–≤–µ—Ä–∫–∞: PaymentWatcher –ª–æ–≥–∏

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢** (–Ω–æ –Ω–µ –≤–∏–¥–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)

**–õ–æ–≥–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –º–∏–Ω—É—Ç:**
```
2026/01/11 20:34:39 PaymentWatcher: Starting payment monitoring for wallet UQCkXFlNRsubUp7Uh7lg_ScUqLCiff1QCLsdQU0a7kphqQED
2026/01/11 20:34:39 PaymentWatcher: Found 0 recent transfers
2026/01/11 20:35:09 PaymentWatcher: Found 0 recent transfers
2026/01/11 20:35:39 PaymentWatcher: Found 0 recent transfers
...
```

**TON API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—ã–π endpoint: `/v2/accounts/{account}/jettons/{jetton}/history`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ `X-API-Key` (–±–µ–∑ Bearer Authorization)
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ `NormalizeAddressForAPI()`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- ‚ö†Ô∏è **–ù–µ –≤–∏–¥–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** (0 transfers) - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω–µ—Ç –≤—Ö–æ–¥—è—â–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- ‚ö†Ô∏è TON API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401 –ø—Ä–∏ health check (–ø—Ä–æ–±–ª–µ–º–∞ —Å –∫–ª—é—á–æ–º/–∞–¥—Ä–µ—Å–æ–º)

**–í—ã–≤–æ–¥:**
- ‚úÖ PaymentWatcher —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω endpoint –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–ø–æ—Å–ª–µ –Ω–∞—à–∏—Ö –ø—Ä–∞–≤–æ–∫)
- ‚ö†Ô∏è –ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ (–Ω—É–∂–Ω—ã —Ä–µ–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏)

---

## ‚úÖ 4. Task Execution & Results

### –ü—Ä–æ–≤–µ—Ä–∫–∞: `/api/v1/device/tasks/:id/result`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢**

**–ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- Endpoint: `POST /api/v1/device/tasks/:id/result` (routes.go:78)
- Handler: `submitResult()` —Å middleware `ValidateResultSubmission()`
- Service: `ResultService.SubmitResult()` –≤ `result_service.go:40`

**–õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
```go
// result_service.go:72-81
UPDATE tasks 
SET status = 'validating',
    result_data = $1,
    result_nonce = $2,
    result_proof = $3,
    execution_time_ms = $4,
    result_submitted_at = NOW()
WHERE task_id = $5
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `ValidationService.verifySignature()` (validation_service.go:310)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Ed25519 –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç public key —á–µ—Ä–µ–∑ TON API

**–í—ã–≤–æ–¥:**
- ‚úÖ Endpoint —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
- ‚úÖ –ü–æ–¥–ø–∏—Å—å –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## ‚úÖ 5. Websocket & Real-time

### –ü—Ä–æ–≤–µ—Ä–∫–∞: WSHub –∏ Redis –∫–∞–Ω–∞–ª

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢**

**–ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- WebSocket endpoint: `/ws` (routes.go:141)
- WSHub: `api/ws_handler.go:53`
- Redis Pub/Sub: `services/redis_pubsub_service.go`
- –ö–∞–Ω–∞–ª: `gstd_tasks_channel`

**–õ–æ–≥–∏:**
```
2026/01/11 20:34:39 ‚úÖ Subscribed to Redis channel: gstd_tasks_channel
2026/01/11 20:34:39 ‚úÖ WSHub subscribed to Redis Pub/Sub channel: gstd_tasks_channel
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ Redis:**
```bash
redis-cli PUBSUB CHANNELS | grep gstd
# –†–µ–∑—É–ª—å—Ç–∞—Ç: gstd_tasks_channel ‚úÖ
```

**–õ–æ–≥–∏–∫–∞ —Ä–∞—Å—Å—ã–ª–∫–∏:**
```go
// task_service.go:59-74
if s.redisPubSub != nil && (task.Status == "pending" || task.Status == "queued") {
    s.redisPubSub.PublishTask(ctx, task.TaskID, task.TaskType, task.Status, payload)
}
```

**–í—ã–≤–æ–¥:**
- ‚úÖ WSHub –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ Redis –∫–∞–Ω–∞–ª
- ‚úÖ –ö–∞–Ω–∞–ª `gstd_tasks_channel` –∞–∫—Ç–∏–≤–µ–Ω
- ‚úÖ –†–∞—Å—Å—ã–ª–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending` –∏–ª–∏ `queued`
- ‚úÖ –í–æ—Ä–∫–µ—Ä—ã –ø–æ–ª—É—á–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebSocket

---

## üîç 6. Database Queries

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**

```sql
-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á
SELECT count(*) FROM tasks;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 0 (–Ω–µ—Ç –∑–∞–¥–∞—á –≤ –ë–î)

-- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã tasks
\d tasks
-- executor_reward_ton: ‚úÖ EXISTS (numeric(20,9))
-- platform_fee_ton: ‚ùå NOT EXISTS (–æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ)
-- labor_compensation_ton: ‚úÖ EXISTS
-- reward_gstd: ‚úÖ EXISTS
-- budget_gstd: ‚úÖ EXISTS
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- ‚ùå **–ö–æ–ª–æ–Ω–∫–∞ `platform_fee_ton` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ `tasks`**
- –≠—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (result_service.go:169)

---

## üö® 7. –û—à–∏–±–∫–∏ 401/403

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–ù–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏:**

```
2026/01/11 20:34:44 Health check: Failed to get contract balance: TON API error (status 401): {"error":"illegal base32 data at input byte 2"}
2026/01/11 20:35:14 Health check: Failed to get contract balance: TON API error (status 401): {"error":"illegal base32 data at input byte 2"}
...
```

**–ê–Ω–∞–ª–∏–∑:**
- ‚ö†Ô∏è **401 –æ—à–∏–±–∫–∏** —Ç–æ–ª—å–∫–æ –≤ health check (–ø—Ä–æ–±–ª–µ–º–∞ —Å TON API –∫–ª—é—á–æ–º/–∞–¥—Ä–µ—Å–æ–º)
- ‚úÖ **–ù–µ—Ç 403 Forbidden** –æ—à–∏–±–æ–∫ –≤ API endpoints
- ‚úÖ **–ù–µ—Ç 401 Unauthorized** –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å `/api/v1/users/login` –∏–ª–∏ `/api/v1/tasks/create`

**–í—ã–≤–æ–¥:**
- ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å TON API –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –≤ health check (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏)
- ‚úÖ API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

---

## üí∞ 8. Pull-–º–æ–¥–µ–ª—å –≤—ã–ø–ª–∞—Ç

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –≤—ã–ø–ª–∞—Ç

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–ê**

**–ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- Endpoint: `POST /api/v1/payments/payout-intent` (routes.go:151)
- Service: `PaymentService.BuildPayoutIntent()` –≤ `payment_service.go:146`

**–õ–æ–≥–∏–∫–∞:**
```go
// reward_engine.go:99-104
// PULL-MODEL: Workers claim rewards themselves via escrow contract
// Platform only generates payout intent, workers sign and pay gas fees
log.Printf("Worker can claim via: POST /api/v1/payments/payout-intent with task_id=%s", task.TaskID)
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. ‚úÖ –í–æ—Ä–∫–µ—Ä –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á—É
2. ‚úÖ –ó–∞–¥–∞—á–∞ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è
3. ‚úÖ `executor_reward_ton` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
4. ‚úÖ –í–æ—Ä–∫–µ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç `POST /api/v1/payments/payout-intent` —Å `task_id`
5. ‚úÖ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç intent –¥–ª—è escrow –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
6. ‚úÖ –í–æ—Ä–∫–µ—Ä –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —á–µ—Ä–µ–∑ TonConnect
7. ‚úÖ Escrow –∫–æ–Ω—Ç—Ä–∞–∫—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã–ø–ª–∞—Ç—É

**–í—ã–≤–æ–¥:**
- ‚úÖ Pull-–º–æ–¥–µ–ª—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –í–æ—Ä–∫–µ—Ä—ã —Å–∞–º–∏ –∑–∞–±–∏—Ä–∞—é—Ç –Ω–∞–≥—Ä–∞–¥—É —á–µ—Ä–µ–∑ TonConnect
- ‚úÖ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

---

## üéØ –ò—Ç–æ–≥–æ–≤—ã–π –≤–µ—Ä–¥–∏–∫—Ç

### –ú–æ–∂–µ—Ç –ª–∏ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–π—Ç–∏ –ø—É—Ç—å –æ—Ç –ª–æ–≥–∏–Ω–∞ –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã?

**–û—Ç–≤–µ—Ç:** ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** (75% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏)

**–ü—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**

1. ‚úÖ **–õ–æ–≥–∏–Ω —á–µ—Ä–µ–∑ –∫–æ—à–µ–ª–µ–∫** ‚Üí –†–∞–±–æ—Ç–∞–µ—Ç (–Ω–æ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏)
2. ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏** ‚Üí –†–∞–±–æ—Ç–∞–µ—Ç (`/api/v1/tasks/create`)
3. ‚ö†Ô∏è **–û–ø–ª–∞—Ç–∞ –∑–∞–¥–∞—á–∏** ‚Üí PaymentWatcher —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
4. ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤–æ—Ä–∫–µ—Ä–æ–º** ‚Üí –†–∞–±–æ—Ç–∞–µ—Ç (`/api/v1/device/tasks/:id/result`)
5. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞** ‚Üí –†–∞–±–æ—Ç–∞–µ—Ç (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–æ–¥–ø–∏—Å–∏)
6. ‚ùå **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏** ‚Üí **–ë–õ–û–ö–ò–†–û–í–ê–ù–û** (–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `platform_fee_ton`)
7. ‚úÖ **–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—ã–ø–ª–∞—Ç—ã –≤–æ—Ä–∫–µ—Ä–æ–º** ‚Üí –†–∞–±–æ—Ç–∞–µ—Ç (Pull-–º–æ–¥–µ–ª—å —á–µ—Ä–µ–∑ `/api/v1/payments/payout-intent`)

---

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ #1: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–ª–æ–Ω–∫–∞ `platform_fee_ton`

**–§–∞–π–ª:** `backend/internal/services/result_service.go:169`

**–û—à–∏–±–∫–∞:**
```go
UPDATE tasks 
SET status = 'completed',
    completed_at = NOW(),
    platform_fee_ton = $1,  // ‚ùå –ö–æ–ª–æ–Ω–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    executor_reward_ton = $2
WHERE task_id = $3
```

**–í–ª–∏—è–Ω–∏–µ:**
- ‚ùå –ë–ª–æ–∫–∏—Ä—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚ùå `executor_reward_ton` –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- ‚ùå –í–æ—Ä–∫–µ—Ä—ã –Ω–µ –º–æ–≥—É—Ç –ø–æ–ª—É—á–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É

**–†–µ—à–µ–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:
```sql
ALTER TABLE tasks ADD COLUMN IF NOT EXISTS platform_fee_ton DECIMAL(20, 9);
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ #2: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ

**–§–∞–π–ª:** `backend/internal/api/routes_user.go:9`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –õ–æ–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ `wallet_address`
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ TonConnect
- –õ—é–±–æ–π –º–æ–∂–µ—Ç –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è, –∑–Ω–∞—è –∞–¥—Ä–µ—Å

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ –≤ `loginUser()` handler.

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. ‚úÖ **Wallet Connection** - Endpoint `/api/v1/users/login` —Ä–∞–±–æ—Ç–∞–µ—Ç
2. ‚úÖ **Task Creation** - Endpoint `/api/v1/tasks/create` —Ä–∞–±–æ—Ç–∞–µ—Ç
3. ‚úÖ **Payment Tracking** - PaymentWatcher —Ä–∞–±–æ—Ç–∞–µ—Ç (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω endpoint)
4. ‚úÖ **Task Execution** - Endpoint `/api/v1/device/tasks/:id/result` —Ä–∞–±–æ—Ç–∞–µ—Ç
5. ‚úÖ **WebSocket & Redis** - WSHub –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ `gstd_tasks_channel`
6. ‚úÖ **Pull-–º–æ–¥–µ–ª—å –≤—ã–ø–ª–∞—Ç** - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ):
1. **–î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É `platform_fee_ton`** –≤ —Ç–∞–±–ª–∏—Ü—É `tasks`
   - –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é `v21_add_platform_fee_ton.sql`
   - –ü—Ä–∏–º–µ–Ω–∏—Ç—å —á–µ—Ä–µ–∑ `./scripts/apply_migrations.sh`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ):
2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ**
   - –û–±–Ω–æ–≤–∏—Ç—å `loginUser()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ TonConnect –ø–æ–¥–ø–∏—Å–∏
   - –£–ª—É—á—à–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ):
3. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å TON API health check**
   - –ü—Ä–æ–±–ª–µ–º–∞ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π (401 illegal base32)
   - –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å |
|-----------|--------|------------|
| Wallet Connection | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 90% |
| Task Creation | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 100% |
| Payment Tracking | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 100% |
| Task Execution | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 100% |
| WebSocket & Redis | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 100% |
| Pull-–º–æ–¥–µ–ª—å –≤—ã–ø–ª–∞—Ç | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 100% |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á | ‚ùå –ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ | 0% |

**–û–±—â–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** **75%**

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ **–ø–æ—á—Ç–∏ –≥–æ—Ç–æ–≤–∞** –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –û—Å–Ω–æ–≤–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞** —Å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º –∫–æ–ª–æ–Ω–∫–∏ `platform_fee_ton` –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∑–∞–¥–∞—á–∏.

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏** –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –±—É–¥–µ—Ç –Ω–∞ **100% –≥–æ—Ç–æ–≤–∞** –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –ø—É—Ç–∏ –æ—Ç –ª–æ–≥–∏–Ω–∞ –¥–æ –≤—ã–ø–ª–∞—Ç—ã.

---

**–î–∞—Ç–∞:** 11 —è–Ω–≤–∞—Ä—è 2026  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Audit Complete
