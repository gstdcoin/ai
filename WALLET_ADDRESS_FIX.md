# ✅ ИСПРАВЛЕНИЕ: Invalid Wallet Address

## Проблема
При отправке запросов возникала ошибка "invalid wallet address" даже для валидных TON адресов.

## Причина
Функция `isValidTONAddress` была слишком строгой и не поддерживала все форматы TON адресов:
- Не учитывала raw format с длиной > 48 символов
- Не поддерживала адреса с дефисами
- Слишком строгая проверка длины

## Решение

### 1. Улучшена функция `isValidTONAddress` в `middleware_validation.go`

Теперь поддерживает:
- ✅ **Raw format**: `0:...` (48 hex символов после `0:`)
- ✅ **User-friendly format**: `EQ...`, `UQ...`, `kQ...`, `0Q...` (48 base64 символов)
- ✅ **С дефисами**: `EQD...-...-...` (user-friendly с дефисами для читаемости)
- ✅ **Гибкая проверка длины**: 44-66 символов (с учетом разных форматов)

### 2. Добавлена валидация в `routes_task_payment.go`

Функция `createTaskWithPayment` теперь проверяет валидность адреса из query параметра или header.

## Форматы TON адресов

### Raw Format
```
0:83dfd552e63729b5fc9934c8e5c5a0c28de7f5e0c2eec7505346bb92986a4040
```
- Начинается с `0:`
- 48 hex символов после `0:`
- Общая длина: 50 символов

### User-Friendly Format
```
EQD... (48 base64 символов)
UQD... (48 base64 символов)
kQD... (48 base64 символов)
0QD... (48 base64 символов)
```

### User-Friendly с дефисами
```
EQD0f1VS5jcSm1_JNMjlxaDCje_X4MLu7dBTNruSmGpAQB
```
- Дефисы удаляются при проверке
- Проверяется base64url формат

## Применение исправления

После обновления кода нужно перезапустить backend:

```bash
docker-compose restart backend
```

Или для полного перезапуска:

```bash
docker-compose down
docker-compose up -d
```

## Проверка

После перезапуска валидные TON адреса должны приниматься без ошибок:
- ✅ Raw format: `0:...`
- ✅ User-friendly: `EQ...`, `UQ...`, `kQ...`, `0Q...`
- ✅ С дефисами: `EQD...-...-...`

## Статус

✅ **ИСПРАВЛЕНО** - Валидация адресов теперь поддерживает все форматы TON адресов.

