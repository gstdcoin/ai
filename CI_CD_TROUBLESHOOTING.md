# üîç CI/CD Troubleshooting Guide

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–±–ª–µ–º

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ workflow –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://github.com/gstdcoin/ai/actions
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ workflows
3. –ï—Å–ª–∏ –Ω–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –≤ `.github/workflows/ci-cd.yml`

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã GitHub

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:
- `SSH_KEY` - –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á
- `SSH_HOST` - IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ (82.115.48.228)
- `SSH_USER` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (ubuntu)
- `SSH_PORT` - –ø–æ—Ä—Ç (22 –∏–ª–∏ –ø—É—Å—Ç–æ)
- `SSH_KNOWN_HOSTS` - known hosts fingerprint

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```bash
./scripts/show-ci-cd-keys.sh
```

### 3. –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

#### –û—à–∏–±–∫–∞: "Permission denied (publickey)"
**–ü—Ä–∏—á–∏–Ω–∞**: SSH –∫–ª—é—á –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç SSH_KEY (–¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `-----BEGIN OPENSSH PRIVATE KEY-----`)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ `~/.ssh/authorized_keys` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞: `chmod 600 ~/.ssh/authorized_keys`

#### –û—à–∏–±–∫–∞: "Host key verification failed"
**–ü—Ä–∏—á–∏–Ω–∞**: SSH_KNOWN_HOSTS –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
**–†–µ—à–µ–Ω–∏–µ**:
```bash
ssh-keyscan -H 82.115.48.228
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—ã–≤–æ–¥ –≤ —Å–µ–∫—Ä–µ—Ç SSH_KNOWN_HOSTS
```

#### –û—à–∏–±–∫–∞: "Docker build failed"
**–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–æ–±–ª–µ–º—ã —Å Dockerfile –∏–ª–∏ build-args
**–†–µ—à–µ–Ω–∏–µ**:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Dockerfile —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ build-args —Ñ–æ—Ä–º–∞—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ build step

#### –û—à–∏–±–∫–∞: "Workflow not triggered"
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –∏–ª–∏ –≤–µ—Ç–∫–∞
**–†–µ—à–µ–Ω–∏–µ**:
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ push –≤ `main` –∏–ª–∏ `develop`
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ "Run workflow" –≤—Ä—É—á–Ω—É—é

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

1. –û—Ç–∫—Ä–æ–π—Ç–µ failed workflow run
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞–∂–¥—ã–π step
3. –û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞:
   - **Setup SSH** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
   - **Deploy to server** - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–ø–ª–æ—è
   - **Verify deployment** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä—É—á–Ω—É—é

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ SSH:
```bash
# –ù–∞ GitHub Actions runner (–≤ workflow)
ssh -i ~/.ssh/id_rsa -o StrictHostKeyChecking=no ubuntu@82.115.48.228 'echo "Connected"'
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–µ–ø–ª–æ–π —Å–∫—Ä–∏–ø—Ç:
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /home/ubuntu
./scripts/deploy.sh
```

### 6. –û—Ç–ª–∞–¥–∫–∞ workflow

–î–æ–±–∞–≤—å—Ç–µ debug —à–∞–≥–∏:
```yaml
- name: Debug
  run: |
    echo "SSH_HOST: ${{ secrets.SSH_HOST }}"
    echo "SSH_USER: ${{ secrets.SSH_USER }}"
    echo "REGISTRY: ${{ env.REGISTRY }}"
    echo "IMAGE_NAME: ${{ env.IMAGE_NAME }}"
```

### 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è:
- `${{ env.REGISTRY }}` ‚Üí `ghcr.io`
- `${{ env.IMAGE_NAME }}` ‚Üí `gstdcoin/ai`
- `${{ secrets.SSH_HOST }}` ‚Üí `82.115.48.228`

### 8. –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å build-args

–ï—Å–ª–∏ build-args –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –≤ workflow
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Dockerfile –ø—Ä–∏–Ω–∏–º–∞–µ—Ç ARG
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Dockerfile

### 9. –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker images

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ–±—Ä–∞–∑—ã —Å–æ–∑–¥–∞—é—Ç—Å—è:
```bash
# –ù–∞ GitHub Container Registry
https://github.com/gstdcoin/ai/pkgs/container/ai-backend
https://github.com/gstdcoin/ai/pkgs/container/ai-frontend
```

### 10. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ø–ª–æ—è

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
docker-compose -f docker-compose.prod.yml ps
curl http://localhost:8080/api/v1/health
curl http://localhost:3000
```

## –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
cd /home/ubuntu

# –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –∫–ª—é—á–∞
cat ~/.ssh/authorized_keys | grep github-actions

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker
docker ps
docker-compose -f docker-compose.prod.yml ps

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Git
git status
git remote -v

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤
ls -la scripts/*.sh
chmod +x scripts/*.sh
```

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–º–æ—â–∏

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ GitHub Actions –ø–æ–ª–Ω–æ—Å—Ç—å—é
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `docker-compose logs`
3. –°–æ–∑–¥–∞–π—Ç–µ issue —Å –ø–æ–ª–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏ –æ—à–∏–±–∫–∏
